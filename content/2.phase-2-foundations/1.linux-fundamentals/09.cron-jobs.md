---
title: "Cron Jobs and Scheduling"
description: "Learn to schedule automated tasks using cron, crontab, and systemd timers."
estimatedMinutes: 12
difficulty: beginner
learningObjectives:
  - "Understand crontab syntax and the five time fields"
  - "Create, edit, and manage cron jobs with crontab"
  - "Use system cron directories for scheduled tasks"
  - "Know when to use systemd timers as an alternative"
quiz:
  passingScore: 70
  questions:
    - question: "What does the cron expression '0 3 * * *' mean?"
      type: single
      options:
        - "Every 3 minutes"
        - "At 3:00 AM every day"
        - "Every 3 hours"
        - "On the 3rd of every month"
      correctAnswer: "At 3:00 AM every day"
      explanation: "Reading the five fields: minute(0), hour(3), day-of-month(*), month(*), day-of-week(*). So it runs at minute 0 of hour 3 (3:00 AM), every day, every month, any day of week."

    - question: "Which command opens the crontab editor for the current user?"
      type: single
      options:
        - "cron -e"
        - "crontab -e"
        - "crontab -l"
        - "edit crontab"
      correctAnswer: "crontab -e"
      explanation: "crontab -e opens the editor to modify your cron jobs. crontab -l lists current jobs. There is no 'cron -e' command."

    - question: "Select all valid cron time specifications."
      type: multiple
      options:
        - "* * * * * (every minute)"
        - "*/5 * * * * (every 5 minutes)"
        - "0 0 * * 0 (weekly on Sunday)"
        - "0 0 1 * * (monthly on the 1st)"
      correctAnswers:
        - "* * * * * (every minute)"
        - "*/5 * * * * (every 5 minutes)"
        - "0 0 * * 0 (weekly on Sunday)"
        - "0 0 1 * * (monthly on the 1st)"
      explanation: "All are valid. Asterisk means 'any value', */5 means 'every 5 units', specific numbers mean 'at that value'. Day of week 0 or 7 is Sunday."

    - question: "Cron jobs run in the same environment as your interactive shell."
      type: true-false
      correctAnswer: false
      explanation: "False. Cron runs jobs in a minimal environment. Many environment variables you expect (like PATH) may be different or missing. This is why many cron issues are related to path problems."

    - question: "Where should you place a script to run it daily on most Linux systems?"
      type: single
      options:
        - "/etc/cron.d/"
        - "/etc/cron.daily/"
        - "/var/spool/cron/"
        - "/etc/crontab"
      correctAnswer: "/etc/cron.daily/"
      explanation: "/etc/cron.daily/ contains scripts that run once per day. Similarly, /etc/cron.hourly/, /etc/cron.weekly/, and /etc/cron.monthly/ exist for other intervals."
---

# Cron Jobs and Scheduling

Cron is the time-based job scheduler in Linux. It runs tasks automatically at specified times. Backups at midnight, log rotation weekly, health checks every minute - cron handles it all.

## Why Scheduling Matters in DevOps

As a DevOps engineer, you schedule:

- Automated backups
- Log rotation and cleanup
- Health checks and monitoring
- Report generation
- System maintenance tasks
- Certificate renewal

## Understanding Crontab Syntax

A cron job has two parts: **when** to run and **what** to run.

### The Five Time Fields

```
* * * * * command-to-run
│ │ │ │ │
│ │ │ │ └── Day of week (0-7, where 0 and 7 are Sunday)
│ │ │ └──── Month (1-12)
│ │ └────── Day of month (1-31)
│ └──────── Hour (0-23)
└────────── Minute (0-59)
```

::illustration-linear-flow
---
steps:
  - label: Minute
    sublabel: "0-59"
    icon: "\U0001F552"
    color: violet
  - label: Hour
    sublabel: "0-23"
    icon: "\U0001F550"
    color: blue
  - label: Day
    sublabel: "1-31"
    icon: "\U0001F4C5"
    color: cyan
  - label: Month
    sublabel: "1-12"
    icon: "\U0001F5D3\uFE0F"
    color: amber
  - label: Weekday
    sublabel: "0-7"
    icon: "\U0001F4C6"
    color: emerald
direction: horizontal
size: full
---
::

### Special Characters

| Character | Meaning | Example |
|-----------|---------|---------|
| `*` | Any value | `* * * * *` (every minute) |
| `,` | List of values | `0,30 * * * *` (at 0 and 30 minutes) |
| `-` | Range | `0 9-17 * * *` (9 AM to 5 PM, every hour) |
| `/` | Step values | `*/15 * * * *` (every 15 minutes) |

### Common Examples

```bash
# Every minute
* * * * * /path/to/script.sh

# Every hour at minute 0
0 * * * * /path/to/script.sh

# Every day at 3:00 AM
0 3 * * * /path/to/script.sh

# Every Monday at 9:00 AM
0 9 * * 1 /path/to/script.sh

# Every 15 minutes
*/15 * * * * /path/to/script.sh

# Twice a day (8 AM and 8 PM)
0 8,20 * * * /path/to/script.sh

# First day of every month at midnight
0 0 1 * * /path/to/script.sh

# Weekdays at 6:30 AM
30 6 * * 1-5 /path/to/script.sh
```

## Managing Your Crontab

Each user has their own crontab. Use `crontab` command to manage it.

### Viewing and Editing

```bash
# View your cron jobs
crontab -l

# Edit your cron jobs
crontab -e

# Remove all your cron jobs
crontab -r

# View another user's crontab (as root)
sudo crontab -l -u ahmed
```

### Adding a Cron Job

```bash
# Open editor
crontab -e

# Add your job (opens in default editor)
# Example: Run backup every night at 2 AM
0 2 * * * /home/ahmed/scripts/backup.sh >> /home/ahmed/logs/backup.log 2>&1

# Save and exit
```

**Important:** Redirect output or cron will try to email it (which usually fails).

```bash
# Redirect stdout and stderr to a log file
0 2 * * * /path/to/script.sh >> /var/log/myjob.log 2>&1

# Discard all output
0 2 * * * /path/to/script.sh > /dev/null 2>&1
```

## System Cron Directories

For system-wide tasks, use these directories:

```bash
/etc/cron.d/          # Individual cron files
/etc/cron.hourly/     # Scripts run every hour
/etc/cron.daily/      # Scripts run every day
/etc/cron.weekly/     # Scripts run every week
/etc/cron.monthly/    # Scripts run every month
```

### Using cron.d

Files in `/etc/cron.d/` use a similar format but include a user field:

```bash
# /etc/cron.d/my-backup
# Run backup as root every night
0 2 * * * root /opt/scripts/backup.sh
```

### Using cron.hourly/daily/weekly/monthly

Just drop an executable script in the directory:

```bash
# Create a daily task
sudo nano /etc/cron.daily/cleanup-tmp

#!/bin/bash
find /tmp -type f -mtime +7 -delete

# Make it executable
sudo chmod +x /etc/cron.daily/cleanup-tmp
```

## Common Cron Pitfalls

::illustration-checklist
---
title: Cron Troubleshooting Tips
items:
  - text: "Use full paths (cron has minimal PATH)"
    icon: "\U0001F4C1"
  - text: "Redirect output to see errors"
    icon: "\U0001F4DD"
  - text: "Make scripts executable (chmod +x)"
    icon: "\U00002705"
  - text: "Check cron logs (/var/log/syslog or cron)"
    icon: "\U0001F50D"
  - text: "Test scripts manually first"
    icon: "\U0001F9EA"
note: Most cron failures are path or permission issues
color: amber
size: 2xl
---
::

### Environment Issues

Cron runs with a minimal environment. Your script might work in terminal but fail in cron.

```bash
# Bad - relies on PATH
0 * * * * mycommand

# Good - use full path
0 * * * * /usr/bin/mycommand

# Or set PATH in crontab
PATH=/usr/local/bin:/usr/bin:/bin
0 * * * * mycommand
```

### Debugging Cron Jobs

```bash
# Check if cron is running
systemctl status cron

# View cron logs
grep CRON /var/log/syslog

# Or on some systems
cat /var/log/cron
```

## The at Command

For one-time scheduled tasks, use `at`:

```bash
# Run command in 5 minutes
echo "/path/to/script.sh" | at now + 5 minutes

# Run at specific time
echo "/path/to/script.sh" | at 3:00 PM

# Run tomorrow
echo "/path/to/script.sh" | at 10:00 tomorrow

# List pending at jobs
atq

# Remove an at job
atrm 1
```

## Systemd Timers (Alternative)

Modern systems can use systemd timers instead of cron. They integrate with journalctl for logging.

### Creating a Timer

Create two files: a service and a timer.

**Service file** (`/etc/systemd/system/backup.service`):
```ini
[Unit]
Description=Backup Service

[Service]
Type=oneshot
ExecStart=/opt/scripts/backup.sh
```

**Timer file** (`/etc/systemd/system/backup.timer`):
```ini
[Unit]
Description=Run backup daily

[Timer]
OnCalendar=daily
Persistent=true

[Install]
WantedBy=timers.target
```

```bash
# Enable and start the timer
sudo systemctl daemon-reload
sudo systemctl enable --now backup.timer

# Check timer status
systemctl list-timers

# View logs
journalctl -u backup.service
```

### When to Use Timers vs Cron

| Cron | Systemd Timers |
|------|----------------|
| Simple syntax | More verbose |
| Widely known | Better logging (journalctl) |
| Works everywhere | Can depend on other services |
| Per-user crontabs | Requires root for system timers |

## Practical Examples

### Daily Backup Script

```bash
# Create backup script
cat > /opt/scripts/daily-backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d)
tar -czf /backups/home-$DATE.tar.gz /home
find /backups -name "home-*.tar.gz" -mtime +7 -delete
EOF

chmod +x /opt/scripts/daily-backup.sh

# Add to crontab (run at 2 AM)
crontab -e
# Add: 0 2 * * * /opt/scripts/daily-backup.sh >> /var/log/backup.log 2>&1
```

### Log Rotation Check

```bash
# Check disk space daily, alert if over 80%
cat > /etc/cron.daily/disk-check << 'EOF'
#!/bin/bash
USAGE=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')
if [ $USAGE -gt 80 ]; then
    echo "Disk usage is ${USAGE}%" | mail -s "Disk Alert" admin@example.com
fi
EOF

chmod +x /etc/cron.daily/disk-check
```

## Key Takeaways

- Cron schedules recurring tasks using five time fields (minute, hour, day, month, weekday)
- `crontab -e` edits your cron jobs; `crontab -l` lists them
- Use full paths in cron - it has a minimal environment
- System-wide tasks go in `/etc/cron.d/` or `/etc/cron.daily/`, etc.
- Redirect output to capture errors: `>> logfile 2>&1`
- Use `at` for one-time scheduled tasks
- Systemd timers are a modern alternative with better logging

In the next lesson, you will learn about log files and how to use journalctl for troubleshooting.
